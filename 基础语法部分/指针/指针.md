# 指针

## 一、指针的格式
- **语法**：`数据类型 *指针变量名;`

**示例**：
```cpp
int *p;        // 指向整型的指针
double *pd;    // 指向双精度浮点数的指针
char *pc;      // 指向字符的指针
```

## 二、指针的使用

### 1. 指针获取变量的地址——取址符 `&`
```cpp
int a = 10;          // 定义一个整型变量
int *p;              // 定义一个整型指针
p = &a;              // 将变量a的地址赋给指针p

// 也可以一步完成
int b = 20;
int *q = &b;         // 定义指针并初始化
```

**记忆口诀**：
- `&` 是"取地址"操作符：`&变量` → 获取变量的地址
- `*` 是"解引用"操作符：`*指针` → 访问指针指向的值

### 2. 指针的占用空间

| 操作系统架构 | 指针大小 | 寻址范围 |
|-------------|---------|---------|
| 32位系统 | 4字节 | 0~4GB (2³²) |
| 64位系统 | 8字节 | 0~16EB (2⁶⁴) |

**示例代码**：
```cpp
#include <iostream>
using namespace std;

int main() {
    int *p1;
    double *p2;
    char *p3;
    
    cout << "int指针大小: " << sizeof(p1) << " 字节" << endl;
    cout << "double指针大小: " << sizeof(p2) << " 字节" << endl;
    cout << "char指针大小: " << sizeof(p3) << " 字节" << endl;
    
    return 0;
}
```
**输出结果**（64位系统）：
```
int指针大小: 8 字节
double指针大小: 8 字节
char指针大小: 8 字节
```

**注意**：无论指针指向什么类型的数据，指针本身的大小只取决于操作系统架构。

---

## 三、空指针与野指针

### 1. 空指针（Null Pointer）
**定义**：指针变量指向内存地址为 0 的空间

**用途**：
- 初始化指针变量，防止成为野指针
- 表示指针当前不指向任何有效的内存地址

**示例**：
```cpp
// 空指针的几种表示方式
int *p1 = 0;         // 直接赋值为0
int *p2 = NULL;      // 使用NULL宏（C风格）
int *p3 = nullptr;   // C++11推荐的方式

// 检查是否为空指针
if (p1 == nullptr) {
    cout << "p1是空指针" << endl;
}
```

**重要**：空指针指向的内存**不可以被访问**
```cpp
int *p = nullptr;
// *p = 10;  // 错误！会导致程序崩溃（段错误）
```

### 2. 野指针（Wild Pointer/Dangling Pointer）
**定义**：指向无效内存地址或已释放内存的指针

**产生原因**：
```cpp
// 情况1：未初始化的指针
int *p1;  // 野指针，指向随机地址
// *p1 = 10;  // 危险操作！

// 情况2：指针指向的内存已被释放
int *p2 = new int(100);
delete p2;  // 释放内存
// p2现在成为野指针
// *p2 = 200;  // 危险操作！

// 情况3：指针指向局部变量（函数返回后）
int* getLocalPointer() {
    int local = 50;
    return &local;  // 返回后，局部变量被销毁，指针变野指针
}
```

**避免野指针的方法**：
1. 指针定义时立即初始化
2. 释放内存后将指针置空
3. 避免返回局部变量的地址

## 四、完整示例程序

```cpp
#include <iostream>
using namespace std;

int main() {
    // 1. 基本指针使用
    int num = 42;
    int *ptr = &num;
    
    cout << "变量num的值: " << num << endl;
    cout << "变量num的地址: " << &num << endl;
    cout << "指针ptr存储的地址: " << ptr << endl;
    cout << "指针ptr指向的值: " << *ptr << endl;
    
    // 2. 通过指针修改变量值
    *ptr = 100;
    cout << "修改后num的值: " << num << endl;
    
    // 3. 空指针示例
    int *nullPtr = nullptr;
    if (nullPtr == nullptr) {
        cout << "nullPtr是安全的空指针" << endl;
    }
    
    // 4. 指针大小验证
    cout << "\n指针大小验证:" << endl;
    cout << "sizeof(int*): " << sizeof(int*) << " 字节" << endl;
    cout << "sizeof(double*): " << sizeof(double*) << " 字节" << endl;
    cout << "sizeof(char*): " << sizeof(char*) << " 字节" << endl;
    
    return 0;
}
```

## 五、总结要点

| 概念 | 说明 | 正确用法 | 错误用法 |
|------|------|---------|---------|
| **指针定义** | 存储地址的变量 | `int *p;` | |
| **取地址** | 获取变量地址 | `p = &a;` | |
| **解引用** | 访问指向的值 | `*p = 10;` | |
| **空指针** | 指向地址0的指针 | `int *p = nullptr;` | `*p = 10;` |
| **指针大小** | 系统决定 | 32位:4字节<br>64位:8字节 | |
| **野指针** | 指向无效地址 | 释放后置空 | 使用未初始化指针 |

**最佳实践**：
1. 总是初始化指针（特别是设为`nullptr`）
2. 使用前检查指针是否为`nullptr`
3. 释放内存后立即将指针置空
4. 优先使用智能指针（现代C++）

**总结**：
空指针和野指针都不是我们自己申请的空间，所以不要随意的访问