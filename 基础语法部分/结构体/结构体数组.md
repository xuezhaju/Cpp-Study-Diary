# 结构体与数组的深入结合

## 1. 结构体中包含数组

```cpp
#include <iostream>
#include <string>
using namespace std;

// 示例1：结构体包含普通数组
struct Student {
    string name;
    int age;
    float scores[3];  // 存储3门课的成绩
};

// 示例2：结构体包含字符数组（C风格字符串）
struct Person {
    char name[20];    // C风格字符串，固定大小
    int id;
};

// 示例3：结构体包含多维数组
struct Matrix {
    double data[3][3];  // 3x3矩阵
    int rows;
    int cols;
};

int main() {
    // 初始化结构体中的数组
    Student s1 = {
        "张三",
        18,
        {85.5, 90.0, 88.5}  // 初始化数组成员
    };
    
    // 访问和修改数组元素
    s1.scores[0] = 95.0;  // 修改第一门课成绩
    cout << "数学成绩: " << s1.scores[0] << endl;
    
    // 遍历结构体中的数组
    for (int i = 0; i < 3; i++) {
        cout << "第" << i+1 << "门课: " << s1.scores[i] << endl;
    }
    
    return 0;
}
```

## 2. 结构体数组（数组的元素是结构体）

```cpp
// 结构体数组：数组的每个元素都是一个结构体
struct Book {
    string title;
    string author;
    float price;
};

int main() {
    // 创建结构体数组（3本书）
    Book library[3] = {
        {"C++ Primer", "Stanley", 128.0},
        {"Effective C++", "Scott", 89.0},
        {"Design Patterns", "Gamma", 99.0}
    };
    
    // 1. 直接访问
    cout << "第一本书: " << library[0].title << endl;
    
    // 2. 遍历结构体数组
    for (int i = 0; i < 3; i++) {
        cout << "书名: " << library[i].title 
             << ", 作者: " << library[i].author
             << ", 价格: " << library[i].price << endl;
    }
    
    // 3. 修改结构体数组元素
    library[1].price = 95.0;  // 修改第二本书价格
    
    // 4. 动态结构体数组
    Book* dynamicBooks = new Book[2];
    dynamicBooks[0] = {"算法导论", "Cormen", 120.0};
    dynamicBooks[1].title = "编译原理";
    dynamicBooks[1].author = "Alfred";
    dynamicBooks[1].price = 85.0;
    
    delete[] dynamicBooks;  // 记得释放内存
    
    return 0;
}
```

## 3. 结构体数组的实际应用：学生管理系统

```cpp
#include <iostream>
#include <string>
#include <iomanip>  // 用于格式化输出
using namespace std;

struct Student {
    int id;            // 学号
    string name;       // 姓名
    float scores[3];   // 三门课成绩
    float average;     // 平均分
    float total;       // 总分
};

// 计算学生总分和平均分
void calculateScore(Student& stu) {
    stu.total = 0;
    for (int i = 0; i < 3; i++) {
        stu.total += stu.scores[i];
    }
    stu.average = stu.total / 3;
}

// 显示所有学生信息
void displayStudents(Student students[], int count) {
    cout << "\n========== 学生成绩表 ==========" << endl;
    cout << left << setw(8) << "学号" 
         << setw(10) << "姓名"
         << setw(8) << "语文"
         << setw(8) << "数学"
         << setw(8) << "英语"
         << setw(8) << "总分"
         << setw(8) << "平均分" << endl;
    cout << "----------------------------------------------" << endl;
    
    for (int i = 0; i < count; i++) {
        cout << left << setw(8) << students[i].id
             << setw(10) << students[i].name
             << setw(8) << fixed << setprecision(1) << students[i].scores[0]
             << setw(8) << students[i].scores[1]
             << setw(8) << students[i].scores[2]
             << setw(8) << students[i].total
             << setw(8) << students[i].average << endl;
    }
}

int main() {
    const int STUDENT_COUNT = 3;
    Student students[STUDENT_COUNT];
    
    // 输入学生信息
    for (int i = 0; i < STUDENT_COUNT; i++) {
        cout << "\n请输入第" << i+1 << "个学生的信息:" << endl;
        students[i].id = i + 1;
        
        cout << "姓名: ";
        cin >> students[i].name;
        
        cout << "语文成绩: ";
        cin >> students[i].scores[0];
        
        cout << "数学成绩: ";
        cin >> students[i].scores[1];
        
        cout << "英语成绩: ";
        cin >> students[i].scores[2];
        
        // 计算总分和平均分
        calculateScore(students[i]);
    }
    
    // 显示学生信息
    displayStudents(students, STUDENT_COUNT);
    
    // 查找最高分学生
    int topIndex = 0;
    for (int i = 1; i < STUDENT_COUNT; i++) {
        if (students[i].total > students[topIndex].total) {
            topIndex = i;
        }
    }
    
    cout << "\n总分最高的学生: " << students[topIndex].name 
         << ", 总分: " << students[topIndex].total << endl;
    
    return 0;
}
```

## 4. 结构体数组的排序

```cpp
#include <iostream>
#include <algorithm>  // 使用sort函数
#include <string>
using namespace std;

struct Employee {
    int id;
    string name;
    double salary;
};

// 按工资降序排序的比较函数
bool compareBySalary(const Employee& a, const Employee& b) {
    return a.salary > b.salary;  // 降序
}

// 按姓名升序排序的比较函数
bool compareByName(const Employee& a, const Employee& b) {
    return a.name < b.name;  // 升序
}

int main() {
    Employee employees[5] = {
        {101, "张三", 8000},
        {102, "李四", 12000},
        {103, "王五", 7500},
        {104, "赵六", 15000},
        {105, "钱七", 9000}
    };
    
    cout << "排序前:" << endl;
    for (int i = 0; i < 5; i++) {
        cout << employees[i].id << " " 
             << employees[i].name << " "
             << employees[i].salary << endl;
    }
    
    // 按工资排序
    sort(employees, employees + 5, compareBySalary);
    
    cout << "\n按工资降序排序后:" << endl;
    for (int i = 0; i < 5; i++) {
        cout << employees[i].id << " " 
             << employees[i].name << " "
             << employees[i].salary << endl;
    }
    
    // 按姓名排序
    sort(employees, employees + 5, compareByName);
    
    cout << "\n按姓名升序排序后:" << endl;
    for (int i = 0; i < 5; i++) {
        cout << employees[i].id << " " 
             << employees[i].name << " "
             << employees[i].salary << endl;
    }
    
    return 0;
}
```

## 5. 结构体中的动态数组

```cpp
#include <iostream>
#include <vector>  // 使用vector作为动态数组
#include <string>
using namespace std;

// 使用vector实现动态数组
struct DynamicStudent {
    string name;
    vector<float> scores;  // 动态数组，成绩数量不固定
    vector<string> courses; // 动态数组，课程名称
    
    // 添加成绩
    void addScore(string course, float score) {
        courses.push_back(course);
        scores.push_back(score);
    }
    
    // 显示所有成绩
    void showScores() {
        cout << name << "的成绩单:" << endl;
        for (size_t i = 0; i < courses.size(); i++) {
            cout << courses[i] << ": " << scores[i] << endl;
        }
    }
};

int main() {
    DynamicStudent stu;
    stu.name = "李华";
    
    // 动态添加成绩
    stu.addScore("数学", 95.5);
    stu.addScore("语文", 88.0);
    stu.addScore("英语", 92.5);
    stu.addScore("物理", 85.0);
    
    stu.showScores();
    
    return 0;
}
```

## 6. 结构体数组和指针的结合

```cpp
struct Product {
    int id;
    string name;
    double price;
    int stock;
};

// 通过指针操作结构体数组
void printProducts(Product* products, int size) {
    for (int i = 0; i < size; i++) {
        cout << "产品" << i+1 << ": "
             << (products + i)->name  // 指针访问方式1
             << ", 价格: " << products[i].price  // 指针访问方式2
             << endl;
    }
}

// 查找产品
Product* findProduct(Product* products, int size, int targetId) {
    for (int i = 0; i < size; i++) {
        if (products[i].id == targetId) {
            return &products[i];  // 返回指针
        }
    }
    return nullptr;  // 没找到
}

int main() {
    Product products[4] = {
        {1001, "iPhone", 6999.0, 50},
        {1002, "iPad", 3299.0, 30},
        {1003, "MacBook", 12999.0, 20},
        {1004, "AirPods", 1299.0, 100}
    };
    
    // 通过函数打印
    printProducts(products, 4);
    
    // 查找产品
    Product* found = findProduct(products, 4, 1003);
    if (found != nullptr) {
        cout << "\n找到产品: " << found->name 
             << ", 库存: " << found->stock << endl;
    }
    
    // 修改产品价格（通过指针）
    if (found != nullptr) {
        found->price = 11999.0;  // 打折
        cout << "打折后价格: " << found->price << endl;
    }
    
    return 0;
}
```

## 7. 二维结构体数组（表格型数据）

```cpp
// 二维结构体数组：适合表示表格数据
struct Cell {
    string content;
    int width;
};

int main() {
    // 创建一个3x4的表格
    Cell table[3][4];
    
    // 初始化表格
    string headers[4] = {"姓名", "年龄", "成绩", "班级"};
    string data[2][4] = {
        {"张三", "18", "95", "一班"},
        {"李四", "19", "88", "二班"}
    };
    
    // 设置表头
    for (int col = 0; col < 4; col++) {
        table[0][col].content = headers[col];
        table[0][col].width = 10;
    }
    
    // 设置数据行
    for (int row = 1; row < 3; row++) {
        for (int col = 0; col < 4; col++) {
            table[row][col].content = data[row-1][col];
            table[row][col].width = 10;
        }
    }
    
    // 打印表格
    cout << "学生信息表:" << endl;
    for (int row = 0; row < 3; row++) {
        for (int col = 0; col < 4; col++) {
            cout << table[row][col].content << "\t";
        }
        cout << endl;
    }
    
    return 0;
}
```

## 8. 结构体数组的高级应用：链表模拟

```cpp
// 使用结构体数组模拟链表
struct Node {
    int data;
    int next;  // 下一个节点的索引，-1表示结束
};

int main() {
    const int MAX_SIZE = 10;
    Node list[MAX_SIZE];
    int head = 0;  // 头节点索引
    int size = 0;  // 当前节点数
    
    // 初始化链表
    list[0] = {10, 1};
    list[1] = {20, 2};
    list[2] = {30, -1};  // 最后一个节点
    size = 3;
    
    // 遍历链表
    cout << "链表内容: ";
    int current = head;
    while (current != -1) {
        cout << list[current].data << " ";
        current = list[current].next;
    }
    cout << endl;
    
    // 添加新节点
    if (size < MAX_SIZE) {
        list[size] = {40, -1};  // 新节点
        list[2].next = size;    // 原最后一个节点指向新节点
        size++;
    }
    
    // 再次遍历
    cout << "添加后链表: ";
    current = head;
    while (current != -1) {
        cout << list[current].data << " ";
        current = list[current].next;
    }
    cout << endl;
    
    return 0;
}
```

## 9. 结构体数组的常见问题

```cpp
// 问题1：数组越界
struct Item {
    int id;
    string name;
};

void commonProblems() {
    Item items[3];
    
    // ❌ 错误：越界访问
    // items[3].id = 100;  // 有效索引是0,1,2
    
    // ✅ 正确：使用循环控制
    for (int i = 0; i < 3; i++) {
        items[i].id = i + 1;
    }
    
    // 问题2：未初始化访问
    Item uninitialized[2];
    // ❌ 危险：可能访问到垃圾值
    // cout << uninitialized[0].id;
    
    // ✅ 正确：初始化后再访问
    Item safe[2] = {{1, "A"}, {2, "B"}};
    
    // 问题3：结构体数组作为函数参数
    // 需要传递数组大小
    void processItems(Item arr[], int size);
}
```

## 10. 练习题目

1. **学生成绩管理系统**
   - 创建包含学生信息的结构体数组
   - 实现添加、删除、查询、排序功能
   - 计算每个学生的平均分和总分

2. **图书管理系统**
   - 使用结构体数组存储图书信息
   - 实现按书名、作者、价格排序
   - 实现借书和还书功能

3. **员工管理系统**
   - 存储员工基本信息和工作记录
   - 计算工资和奖金
   - 生成统计报表

## 总结

| 结合方式 | 特点 | 适用场景 |
|---------|------|---------|
| **结构体中包含数组** | 结构体成员是数组 | 存储一组相关数据（如多科成绩） |
| **结构体数组** | 数组元素是结构体 | 管理多个相同类型的对象 |
| **结构体中的动态数组** | 使用vector等容器 | 数据量不确定的情况 |
| **结构体数组指针** | 通过指针操作 | 函数参数传递、动态内存管理 |
| **二维结构体数组** | 表格型数据 | 报表、网格数据 |

**最佳实践：**
1. 对于固定大小的数据，使用普通数组
2. 对于动态数据，使用vector等容器
3. 传递结构体数组时，同时传递数组大小
4. 合理使用const保护数据
5. 考虑使用智能指针管理动态内存