# 结构体详解

## 1. 结构体的基本概念
- 结构体属于用户 **自定义的数据类型**，允许用户存储不同的数据类型
- 它是**复合数据类型**，可以将多个不同类型的数据组合在一起
- 结构体在内存中是**连续存储**的（可能有内存对齐）

## 2. 结构体的定义和使用

### 语法：
```cpp
struct 结构体名 {
    // 成员变量（属性）
    数据类型1 成员名1;
    数据类型2 成员名2;
    // ...
    
    // C++中还可以有成员函数（方法）
    void display() {
        cout << "姓名:" << name << ", 年龄:" << age;
    }
};
```

## 3. 创建结构体变量的三种方式

### 方式1：先定义后创建（最常用）
```cpp
// 1. 定义结构体类型
struct Student {
    string name;
    int age;
    float score;
};

// 2. 创建变量（实例化）
int main() {
    // struct关键字可以省略（C++特性）
    Student s1;                    // 方式1-1：先声明后赋值
    Student s2 = {"张三", 18, 90.5}; // 方式1-2：声明时初始化
    
    s1.name = "李四";
    s1.age = 20;
    s1.score = 88.5;
    
    return 0;
}
```

### 方式2：定义时直接创建变量（不推荐，少用）
```cpp
// 定义结构体的同时创建变量
struct Point {
    int x;
    int y;
} p1, p2;  // 直接创建了p1和p2两个变量

// 还可以初始化
struct Rectangle {
    int width;
    int height;
} rect = {10, 20};  // 定义时创建并初始化

int main() {
    p1.x = 10;  // 直接使用
    p2.y = 20;
    return 0;
}
```

### 方式3：使用typedef简化（C风格，C++中少用）
```cpp
// 使用typedef创建别名
typedef struct {
    string brand;
    double price;
} Car;  // Car现在是类型名，不是变量名

int main() {
    Car c1;  // 直接使用Car，不需要struct关键字
    Car c2 = {"BMW", 50.5};
    return 0;
}
```

## 4. 重要细节补充

### 关于struct关键字
```cpp
// C语言中：必须使用struct关键字
struct Student s1;  // C语言必须这样写

// C++中：struct关键字可以省略
Student s2;         // C++中可以省略struct

// 但以下情况不能省略：
// 1. 当结构体名与其他标识符冲突时
int Student;        // 有一个变量叫Student
struct Student s3;  // 必须加struct区分

// 2. 在定义结构体自身时
struct Node {
    int data;
    struct Node* next;  // 这里需要struct（C++中也可省略）
};
```

### 初始化的多种方式（C++11及以上）
```cpp
struct Person {
    string name;
    int age = 18;  // C++11支持成员默认值
    string address;
};

int main() {
    // 方式1：传统初始化
    Person p1 = {"张三", 20, "北京"};
    
    // 方式2：指定成员初始化（C++20）
    // Person p2 = {.name = "李四", .age = 25};
    
    // 方式3：列表初始化
    Person p3{"王五", 22, "上海"};
    
    // 方式4：部分初始化
    Person p4 = {"赵六"};  // age使用默认值18，address为空
    
    return 0;
}
```

## 5. 结构体的内存布局

```cpp
#include <iostream>
using namespace std;

struct Example {
    char c;     // 1字节
    int i;      // 4字节
    double d;   // 8字节
};

int main() {
    cout << "结构体大小: " << sizeof(Example) << "字节" << endl;
    // 可能是16或24字节（因为内存对齐）
    
    Example e;
    cout << "地址分析:" << endl;
    cout << "整个结构体: " << &e << endl;
    cout << "成员c: " << (void*)&e.c << endl;
    cout << "成员i: " << &e.i << endl;
    cout << "成员d: " << &e.d << endl;
    
    return 0;
}
```

## 6. 结构体的嵌套

```cpp
struct Date {
    int year;
    int month;
    int day;
};

struct Student {
    string name;
    int age;
    Date birthday;  // 嵌套结构体
    float scores[3]; // 数组成员
};

int main() {
    Student s1 = {
        "小明",
        18,
        {2005, 9, 1},  // 初始化嵌套结构体
        {85.5, 90.0, 88.5}
    };
    
    cout << s1.name << "的生日: "
         << s1.birthday.year << "-"
         << s1.birthday.month << "-"
         << s1.birthday.day << endl;
    
    return 0;
}
```

## 7. 结构体数组

```cpp
struct Book {
    string title;
    string author;
    float price;
};

int main() {
    // 创建结构体数组
    Book library[3] = {
        {"C++ Primer", "Stanley", 128.0},
        {"Effective C++", "Scott", 89.0},
        {"Design Patterns", "Gamma", 99.0}
    };
    
    // 访问
    for (int i = 0; i < 3; i++) {
        cout << "书名: " << library[i].title
             << ", 作者: " << library[i].author
             << ", 价格: " << library[i].price << endl;
    }
    
    return 0;
}
```

## 8. 结构体指针

```cpp
struct Point {
    int x;
    int y;
};

int main() {
    Point p = {10, 20};
    Point* ptr = &p;  // 结构体指针
    
    // 访问方式1：解引用后用.
    cout << "x = " << (*ptr).x << endl;
    
    // 访问方式2：使用->运算符（推荐）
    cout << "y = " << ptr->y << endl;
    
    // 修改成员
    ptr->x = 100;
    ptr->y = 200;
    
    return 0;
}
```

## 9. 结构体作为函数参数和返回值

```cpp
struct Vector2D {
    float x;
    float y;
};

// 结构体作为参数（值传递）
void printVector(Vector2D v) {
    cout << "(" << v.x << ", " << v.y << ")" << endl;
}

// 结构体作为参数（引用传递，避免复制）
void scaleVector(Vector2D& v, float factor) {
    v.x *= factor;
    v.y *= factor;
}

// 结构体作为返回值
Vector2D addVectors(Vector2D a, Vector2D b) {
    return {a.x + b.x, a.y + b.y};  // 返回临时结构体
}

int main() {
    Vector2D v1 = {1.0, 2.0};
    Vector2D v2 = {3.0, 4.0};
    
    printVector(v1);
    scaleVector(v1, 2.0);
    printVector(v1);
    
    Vector2D v3 = addVectors(v1, v2);
    printVector(v3);
    
    return 0;
}
```

## 10. 常见错误

```cpp
// 错误1：忘记分号
struct Student {
    string name;
    int age;
};  // ← 这里必须有分号！

// 错误2：重复定义
// struct Student { ... };  // 不能重复定义同名结构体

// 错误3：在C++中这样定义不合法（C可以）
// struct {
//     int x;
//     int y;
// };  // 匿名结构体必须同时创建变量

// 正确：匿名结构体必须创建变量
struct {
    int width;
    int height;
} screenSize = {1920, 1080};
```

## 11. 结构体 vs 类

```cpp
// 结构体（默认public）
struct S {
    int x;  // 默认public
    void show() { cout << x; }
};

// 类（默认private）
class C {
    int x;  // 默认private
public:
    void show() { cout << x; }
};

int main() {
    S s;
    s.x = 10;  // 可以直接访问
    s.show();
    
    C c;
    // c.x = 10;  // 错误！private成员
    c.show();
    
    return 0;
}
```

## 总结表格

| 特性 | 说明 |
|------|------|
| **定义** | `struct 名称 { 成员列表 };` |
| **创建变量** | 方式1：`Student s1;` <br> 方式2：`Student s2 = {...};` <br> 方式3：定义时创建 |
| **struct关键字** | 定义时必须用，创建变量时C++可省略 |
| **内存** | 连续存储，有内存对齐 |
| **访问成员** | 变量用`.`，指针用`->` |
| **作为参数** | 推荐用`const 类型&`或`类型&` |
| **与类区别** | struct默认public，class默认private |

**最佳实践建议：**
1. 结构体定义放在头文件中
2. 使用有意义的成员名
3. 对于大型结构体，传递引用避免复制
4. 合理使用const保护数据
5. C++中优先使用struct而不是typedef